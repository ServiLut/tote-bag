generator client {
  provider        = "prisma-client"
  output          = "../src/generated/client"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  schemas  = ["tote-bag"]
}

model Product {
  id               String         @id @default(uuid()) @map("id")
  name             String         @map("name")
  description      String         @map("description")
  basePrice        Float          @map("base_price")
  minPrice         Float          @map("min_price")
  comparePrice     Float?         @map("compare_price")
  costPrice        Float?         @map("cost_price")
  status           ProductStatus  @default(BAJO_PEDIDO) @map("status")
  collectionId     String         @map("collection_id")
  slug             String         @unique @map("slug")
  seoTitle         String?        @map("seo_title")
  seoDescription   String?        @map("seo_description")
  tags             String[]       @default([]) @map("tags")
  deliveryTime     String         @map("delivery_time")
  material         String         @default("Algod√≥n resistente") @map("material")
  dimensions       String?        @map("dimensions")
  careInstructions String?        @map("care_instructions")
  printType        PrintType      @default(DTF) @map("print_type")
  isActive         Boolean        @default(true) @map("is_active")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  orderItems       OrderItem[]
  images           ProductImage[]
  collection       Collection     @relation(fields: [collectionId], references: [id])
  variants         Variant[]

  @@map("products")
  @@schema("tote-bag")
}

model ProductImage {
  id        String  @id @default(uuid()) @map("id")
  url       String  @map("url")
  alt       String? @map("alt")
  position  Int     @default(0) @map("position")
  productId String  @map("product_id")
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
  @@schema("tote-bag")
}

model Collection {
  id        String    @id @default(uuid()) @map("id")
  name      String    @map("name")
  slug      String    @unique @map("slug")
  isActive  Boolean   @default(true) @map("is_active")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  products  Product[]

  @@map("collections")
  @@schema("tote-bag")
}

model Variant {
  id         String      @id @default(uuid()) @map("id")
  sku        String      @unique @map("sku")
  color      String      @map("color")
  imageUrl   String      @map("image_url")
  stock      Int         @default(0) @map("stock")
  productId  String      @map("product_id")
  orderItems OrderItem[]
  product    Product     @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("variants")
  @@schema("tote-bag")
}

model Order {
  id              String               @id @default(uuid()) @map("id")
  orderNumber     Int                  @unique @default(autoincrement()) @map("order_number")
  customerEmail   String               @map("customer_email")
  customerPhone   String               @map("customer_phone")
  shippingAddress Json                 @map("shipping_address")
  city            String               @map("city")
  totalAmount     Float                @map("total_amount")
  currency        String               @default("COP") @map("currency")
  status          OrderStatus          @default(PENDIENTE_PAGO) @map("status")
  trackingNumber  String?              @map("tracking_number")
  carrier         String?              @map("carrier")
  isB2B           Boolean              @default(false) @map("is_b2b")
  createdAt       DateTime             @default(now()) @map("created_at")
  profileId       String?              @map("profile_id")
  items           OrderItem[]
  statusHistory   OrderStatusHistory[]
  profile         Profile?             @relation(fields: [profileId], references: [id])

  @@map("orders")
  @@schema("tote-bag")
}

model OrderStatusHistory {
  id        String      @id @default(uuid()) @map("id")
  orderId   String      @map("order_id")
  status    OrderStatus @map("status")
  createdAt DateTime    @default(now()) @map("created_at")
  order     Order       @relation(fields: [orderId], references: [id])

  @@map("order_status_history")
  @@schema("tote-bag")
}

model OrderItem {
  id        String   @id @default(uuid()) @map("id")
  quantity  Int      @map("quantity")
  price     Float    @map("price")
  sku       String   @map("sku")
  orderId   String   @map("order_id")
  productId String   @map("product_id")
  variantId String?  @map("variant_id")
  order     Order    @relation(fields: [orderId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
  variant   Variant? @relation(fields: [variantId], references: [id])

  @@map("order_items")
  @@schema("tote-bag")
}

model User {
  id        String     @id @map("id")
  email     String     @unique @map("email")
  role      Role       @default(CUSTOMER) @map("role")
  isActive  Boolean    @default(true) @map("is_active")
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  auditLogs AuditLog[]
  profile   Profile?

  @@map("users")
  @@schema("tote-bag")
}

model Profile {
  id                   String        @id @default(uuid()) @map("id")
  email                String        @unique @map("email")
  firstName            String?       @map("first_name")
  lastName             String?       @map("last_name")
  phone                String?       @map("phone")
  department           String?       @map("department")
  municipality         String?       @map("municipality")
  neighborhood         String?       @map("neighborhood")
  address              String?       @map("address")
  createdAt            DateTime      @default(now()) @map("created_at")
  updatedAt            DateTime      @updatedAt @map("updated_at")
  userId               String        @unique @map("user_id")
  metadata             Json?         @map("metadata")
  departmentId         String?       @map("department_id")
  municipalityId       String?       @map("municipality_id")
  addresses            Address[]
  orders               Order[]
  locationDepartment   Department?   @relation(fields: [departmentId], references: [id])
  locationMunicipality Municipality? @relation(fields: [municipalityId], references: [id])
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("profiles")
  @@schema("tote-bag")
}

model Department {
  id             String         @id @default(uuid()) @map("id")
  name           String         @unique @map("name")
  code           String?        @unique @map("code")
  addresses      Address[]
  municipalities Municipality[]
  profiles       Profile[]

  @@map("departments")
  @@schema("tote-bag")
}

model Municipality {
  id           String     @id @default(uuid()) @map("id")
  name         String     @map("name")
  code         String?    @map("code")
  departmentId String     @map("department_id")
  addresses    Address[]
  department   Department @relation(fields: [departmentId], references: [id])
  profiles     Profile[]

  @@unique([departmentId, name])
  @@map("municipalities")
  @@schema("tote-bag")
}

model B2BQuote {
  id           String   @id @default(uuid()) @map("id")
  businessName String   @map("business_name")
  quantity     Int      @map("quantity")
  department   String   @map("department")
  municipality String   @map("municipality")
  neighborhood String   @map("neighborhood")
  address      String   @map("address")
  contactPhone String   @map("contact_phone")
  qrType       String   @map("qr_type")
  qrData       String?  @map("qr_data")
  logoUrl      String?  @map("logo_url")
  package      String   @map("package")
  status       String   @default("PENDIENTE") @map("status")
  createdAt    DateTime @default(now()) @map("created_at")

  @@map("b2b_quotes")
  @@schema("tote-bag")
}

model AuditLog {
  id           String   @id @default(uuid()) @map("id")
  action       String   @map("action")
  entity       String   @map("entity")
  entityId     String?  @map("entity_id")
  payload      Json?    @map("payload")
  userId       String?  @map("user_id")
  ip           String?  @map("ip")
  userAgent    String?  @map("user_agent")
  createdAt    DateTime @default(now()) @map("created_at")
  previousData Json?    @map("previous_data")
  user         User?    @relation(fields: [userId], references: [id])

  @@map("audit_logs")
  @@schema("tote-bag")
}

model Address {
  id             String       @id @default(uuid()) @map("id")
  profileId      String       @map("profile_id")
  title          String       @map("title")
  firstName      String       @map("first_name")
  lastName       String       @map("last_name")
  phone          String       @map("phone")
  departmentId   String       @map("department_id")
  municipalityId String       @map("municipality_id")
  address        String       @map("address")
  neighborhood   String?      @map("neighborhood")
  additionalInfo String?      @map("additional_info")
  isDefault      Boolean      @default(false) @map("is_default")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  department     Department   @relation(fields: [departmentId], references: [id])
  municipality   Municipality @relation(fields: [municipalityId], references: [id])
  profile        Profile      @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("addresses")
  @@schema("tote-bag")
}

enum OrderStatus {
  PENDIENTE_PAGO
  PAGADA
  EN_PRODUCCION
  ENVIADA
  ENTREGADA
  CANCELADA

  @@schema("tote-bag")
}

enum Role {
  ADMIN
  CUSTOMER
  VIEWER
  ADVISOR

  @@schema("tote-bag")
}

enum ProductStatus {
  DISPONIBLE
  BAJO_PEDIDO
  PREVENTA

  @@schema("tote-bag")
}

enum PrintType {
  SERIGRAFIA
  DTF

  @@schema("tote-bag")
}
